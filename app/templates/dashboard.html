{% extends "base.html" %}
{% block content %}
<style>
    .dashboard-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .dashboard-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .dashboard-card h3 {
        margin-top: 0;
        font-size: 1.1em;
    }
    
    .card-stat {
        font-size: 2em;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .card-description {
        font-size: 0.9em;
        opacity: 0.9;
    }
    
    .quick-actions {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .action-btn {
        padding: 15px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }
    
    .action-btn.primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .action-btn.secondary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
    }
    
    .action-btn.tertiary {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
    }
    
    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    
    .ai-assistant {
        background: white;
        border: 2px solid #667eea;
        border-radius: 10px;
        padding: 20px;
        margin-top: 30px;
    }
    
    .ai-assistant h3 {
        color: #667eea;
        margin-top: 0;
    }
    
    .chat-box {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 8px;
        height: 300px;
        overflow-y: auto;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .chat-message {
        margin-bottom: 12px;
        padding: 10px;
        border-radius: 6px;
        word-wrap: break-word;
    }
    
    .user-msg {
        background: #667eea;
        color: white;
        margin-left: 20%;
        text-align: right;
    }
    
    .ai-msg {
        background: #e9ecef;
        color: #333;
        margin-right: 20%;
    }
    
    .chat-input-group {
        display: flex;
        gap: 10px;
    }
    
    .chat-input-group input {
        flex: 1;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1em;
    }
    
    .chat-input-group button {
        padding: 12px 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
    }
    
    .chat-input-group button:hover {
        transform: translateY(-2px);
    }
    
    .welcome-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
    }
    
    .welcome-header h2 {
        margin: 0 0 10px 0;
    }
    
    .user-info {
        font-size: 0.95em;
        opacity: 0.95;
    }
    
    @media (max-width: 768px) {
        .dashboard-container {
            grid-template-columns: 1fr;
        }
        
        .quick-actions {
            grid-template-columns: 1fr;
        }
    }
</style>

<div style="text-align: right; margin-bottom: 20px;">
    <a href="/logout" style="color: #667eea; text-decoration: none; font-weight: bold; padding: 10px 15px; border: 2px solid #667eea; border-radius: 6px; transition: all 0.3s;">üö™ Logout</a>
</div>

<div class="welcome-header">
    <h2>Welcome to FinShield AI, {{ user }}! üõ°Ô∏è</h2>
    <div class="user-info">
        <strong>Account Type:</strong> {{ type }} | <strong>Status:</strong> Active & Protected
    </div>
</div>

<div class="dashboard-container">
    <div class="dashboard-card">
        <h3>üìä Your Security Status</h3>
        <div class="card-stat">Active</div>
        <div class="card-description">Your account is actively monitoring for fraudulent activities</div>
    </div>
    
    <div class="dashboard-card">
        <h3>üîç High Risk Transactions</h3>
        <div class="card-stat" id="threat-count">{{ stats.high_risk_count }}</div>
        <div class="card-description">Transactions flagged with high fraud risk</div>
    </div>
    
    <div class="dashboard-card">
        <h3>‚úÖ Safe Transactions</h3>
        <div class="card-stat" id="safe-count">{{ stats.safe_count }}</div>
        <div class="card-description">Verified safe activities analyzed</div>
    </div>
    
    <div class="dashboard-card">
        <h3>üí∞ Total Transactions</h3>
        <div class="card-stat">{{ stats.total_transactions }}</div>
        <div class="card-description">All transactions you've analyzed</div>
    </div>
</div>

<div class="quick-actions">
    <a href="/analyze_transaction" class="action-btn primary">üí≥ Analyze Transaction</a>
    <a href="/check" class="action-btn secondary">üîé Check Text</a>
    <a href="/transaction_history" class="action-btn tertiary">üìã Transaction History</a>
</div>

<div class="ai-assistant">
    <h3>ü§ñ AI Fraud Detection Assistant</h3>
    <p>Ask me anything about fraud detection, scam prevention, or financial security!</p>
    
    <div class="chat-box" id="chatBox"></div>
    
    <div class="chat-input-group">
        <input type="text" id="userInput" placeholder="Ask about fraud detection, reporting scams, etc..." />
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    // AI Assistant responses
    const aiResponses = {
        "transaction": "Use our real-time transaction analyzer to check any payment before you send money. Just enter the recipient, amount, and details. It will give you a risk score and specific warnings.",
        "before sending": "Always analyze transactions before sending money! Go to 'Analyze Transaction' and enter the recipient details. Our AI will instantly check for fraud indicators.",
        "ponzi": "Ponzi schemes promise high returns but collapse when new investors stop joining. Red flags: guaranteed returns, pressure to recruit, complex structure. NEVER invest in these!",
        "pyramid": "Pyramid schemes collapse and most participants lose money. They focus on recruiting rather than selling products. If the emphasis is on recruitment, it's a scam.",
        "investment scam": "Fake investment schemes promise unrealistic returns. Legitimate investments: never guarantee profits, are registered with regulators, don't pressure you, and don't require upfront fees.",
        "crypto scam": "Crypto scams are rampant. Watch for: promises of easy money, celebrity endorsements, pressure to act fast. NEVER give anyone your seed phrase or private key!",
        "seed phrase": "Your seed phrase is like a master password. NEVER share it with anyone, ever. If someone asks for it, they're trying to steal your crypto. Block them immediately.",
        "risk score": "Our AI gives each transaction a 0-100 risk score: 0-19=SAFE ‚úÖ, 20-39=LOW üü°, 40-59=MEDIUM üü°, 60-79=HIGH ‚ö†Ô∏è, 80-100=CRITICAL üö®",
        "how": "I help detect fraud in real-time! Ask about: transaction risks, scam types, how to verify recipients, red flags, or analysis tips.",
        "scam": "Common scams include: urgent money requests, guaranteed returns, crypto giveaways, fake investments, and Ponzi schemes. Be suspicious of unsolicited messages.",
        "protect": "Protect yourself by: analyzing transactions before sending, verifying recipient identity, enabling 2FA, never sharing passwords, and reporting suspicious activity.",
        "report": "Report scams in our platform! Go to 'Report Scam' to submit details. Your reports help protect others in our community.",
        "urgent": "Scammers create urgency to prevent thinking. Legitimate companies don't pressure you. Take time to verify before acting on urgent requests.",
        "money": "If asked to send money upfront, it's usually a scam. Legitimate services don't require advance payment for prizes or loans.",
        "verify": "Verify payments by contacting organizations directly using official contact info, NOT numbers from suspicious messages.",
        "warning": "Our system detects multiple fraud warnings automatically. Multiple red flags = CRITICAL RISK. DO NOT SEND.",
        "default": "I'm your FinShield AI Assistant! I can help with: transaction analysis, scam types (Ponzi, Pyramid, Crypto, Investment), fraud prevention, and risk assessment. What would you like to know?"
    };

    function sendMessage() {
        const input = document.getElementById('userInput').value.trim();
        if (!input) return;
        
        const chatBox = document.getElementById('chatBox');
        
        // Display user message
        const userMsg = document.createElement('div');
        userMsg.className = 'chat-message user-msg';
        userMsg.textContent = input;
        chatBox.appendChild(userMsg);
        
        // Generate AI response
        const userLower = input.toLowerCase();
        let response = aiResponses.default;
        
        for (let key in aiResponses) {
            if (userLower.includes(key)) {
                response = aiResponses[key];
                break;
            }
        }
        
        // Display AI response after a short delay
        setTimeout(() => {
            const aiMsg = document.createElement('div');
            aiMsg.className = 'chat-message ai-msg';
            aiMsg.textContent = 'ü§ñ ' + response;
            chatBox.appendChild(aiMsg);
            chatBox.scrollTop = chatBox.scrollHeight;
        }, 300);
        
        // Clear input
        document.getElementById('userInput').value = '';
        chatBox.scrollTop = chatBox.scrollHeight;
    }
    
    // Allow Enter key to send message
    document.getElementById('userInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') sendMessage();
    });
    
    // Load threat and safe counts from alerts
    function loadStats() {
        // Stats are now loaded from backend
        // Display only if not already populated
    }
    
    // Welcome message from AI
    window.addEventListener('load', function() {
        const chatBox = document.getElementById('chatBox');
        const welcomeMsg = document.createElement('div');
        welcomeMsg.className = 'chat-message ai-msg';
        welcomeMsg.textContent = 'ü§ñ Welcome back! üõ°Ô∏è I can help you analyze transactions for fraud in real-time. Ask me about Ponzi schemes, crypto scams, investment frauds, or use our Transaction Analyzer to check before you send money!';
        chatBox.appendChild(welcomeMsg);
        loadStats();
    });
</script>
{% endblock %}
